# Flutter XTerm 개발 계획

## Phase 1: 기본 인프라 구축

### 1.1 데이터 구조
- [x] `TerminalCell` 클래스 구현
  - 문자, 전경색, 배경색, 스타일(bold, italic, underline) 속성
- [x] `TerminalBuffer` 클래스 구현
  - 2D 셀 배열 (rows x cols)
  - 라인별 접근 메서드
  - 버퍼 크기 조정 메서드
- [x] `Cursor` 클래스 구현
  - x, y 좌표
  - 표시 여부, 스타일
  - 이동 메서드

### 1.2 터미널 코어
- [x] `Terminal` 클래스 구현
  - 버퍼 관리 (메인 버퍼)
  - 커서 관리
  - 터미널 크기 설정
  - 텍스트 쓰기 기본 메서드
- [x] 기본 텍스트 출력 로직
  - 일반 문자 출력
  - 줄바꿈(\n), 캐리지 리턴(\r) 처리
  - 탭(\t) 처리 (8칸 단위)
  - 자동 줄바꿈

### ✅ Phase 1 완료 후 기대 결과
- **터미널 데이터 구조 완성**: 메모리상에 터미널 상태를 완전히 표현할 수 있음
- **테스트 가능**: `terminal.write("Hello\nWorld")` 같은 코드로 버퍼에 텍스트 쓰기 가능
- **Example 앱에서 확인**: 버퍼 내용을 Text 위젯으로 출력해서 동작 확인
- **다음 단계 준비**: ANSI escape sequence 파서가 버퍼를 조작할 준비 완료

## Phase 2: ANSI Escape Sequence 파싱

### 2.1 파서 기본
- [x] `EscapeSequenceParser` 클래스 구현
  - 상태 머신 기반 파서
  - ESC, CSI, OSC 시퀀스 감지
- [x] 파싱 결과를 나타내는 데이터 구조
  - Command enum 정의
  - 파라미터 저장

### 2.2 CSI 시퀀스 구현 (가장 중요)
- [x] 커서 이동
  - CUU (커서 위로), CUD (아래), CUF (오른쪽), CUB (왼쪽)
  - CHA (절대 수평 위치), VPA (절대 수직 위치)
  - CUP (커서 위치 설정)
  - home, end
- [x] 화면 조작
  - ED (화면 지우기): 0=아래, 1=위, 2=전체
  - EL (라인 지우기): 0=오른쪽, 1=왼쪽, 2=전체
- [x] SGR (텍스트 속성)
  - 0: 리셋
  - 1: bold, 3: italic, 4: underline
  - 30-37: 전경색 (8색)
  - 40-47: 배경색 (8색)
  - 90-97: 밝은 전경색
  - 100-107: 밝은 배경색
  - 38;5;n: 256색 전경
  - 38;2;r;g;b: RGB 전경
  - 48;5;n: 256색 배경
  - 48;2;r;g;b: RGB 배경

### 2.3 기타 시퀀스
- [x] OSC 시퀀스
  - 타이틀 설정 (OSC 0, 2)
- [x] 대체 스크린 버퍼
  - CSI ?1049h (진입), CSI ?1049l (종료)

### ✅ Phase 2 완료 후 기대 결과
- **ANSI 시퀀스 처리**: `\x1b[31mRed Text\x1b[0m` 같은 escape sequence 파싱 가능
- **색상 적용**: 터미널에 색상 코드가 포함된 텍스트 출력 시 셀에 올바른 색상 저장
- **커서 조작**: `\x1b[H` (home), `\x1b[2J` (화면 지우기) 등의 명령 처리
- **Example 앱에서 확인**: 다양한 ANSI 시퀀스를 포함한 텍스트를 출력해서 파싱 결과 확인
- **다음 단계 준비**: 파싱된 결과를 화면에 렌더링할 준비 완료

## Phase 3: UI 렌더링

### 3.1 기본 렌더링
- [ ] `TerminalPainter` (CustomPainter) 구현
  - 셀별 텍스트 렌더링
  - 배경색 적용
  - 커서 렌더링 (깜빡임)
- [ ] `TerminalView` 위젯 구현
  - CustomPaint 래핑
  - 크기 계산 (폰트 크기 기반)
- [ ] 폰트 설정
  - 고정폭 폰트 (monospace)
  - 폰트 크기 조정 가능
  - 셀 크기 계산 (width, height)

### 3.2 스타일 적용
- [ ] 텍스트 스타일 렌더링
  - bold, italic, underline 적용
- [ ] 색상 팔레트
  - 기본 16색 정의
  - 256색 팔레트
  - RGB 색상 지원

### 3.3 성능 최적화
- [ ] 더티 영역만 다시 그리기
- [ ] 텍스트 캐싱 (TextPainter 재사용)

### ✅ Phase 3 완료 후 기대 결과
- **화면에 터미널 표시**: Flutter 앱에서 실제 터미널처럼 보이는 위젯 렌더링
- **색상과 스타일 적용**: 빨강, 파랑 등 색상 텍스트와 bold, underline 스타일 표시
- **커서 표시**: 깜빡이는 커서 확인
- **Example 앱에서 확인**:
  - "Hello, World!" 출력
  - 색상이 적용된 텍스트 표시
  - 커서 위치 확인
- **다음 단계 준비**: 사용자가 키보드로 입력할 준비 완료

## Phase 4: 입력 처리

### 4.1 키보드 입력
- [ ] `TerminalInputHandler` 구현
- [ ] 일반 문자 입력
- [ ] 특수 키 매핑
  - Enter → \r 또는 \n
  - Backspace → \x7f
  - Arrow keys → CSI 시퀀스 (\e[A, \e[B, \e[C, \e[D)
  - Home/End → CSI 시퀀스
  - Page Up/Down
  - Function keys (F1-F12)
- [ ] Ctrl 조합 처리
  - Ctrl+C → \x03
  - Ctrl+D → \x04
  - 기타 Ctrl+키 조합

### 4.2 IME 지원
- [ ] 한글/중국어/일본어 입력 처리
- [ ] 조합 중 텍스트 표시

### ✅ Phase 4 완료 후 기대 결과
- **키보드 입력 가능**: 터미널에 타이핑하면 화면에 문자 표시
- **특수 키 동작**: Enter, Backspace, 화살표 키 등이 올바르게 처리됨
- **한글 입력**: IME를 통한 한글, 일본어, 중국어 입력 가능
- **Example 앱에서 확인**:
  - 키보드로 입력하면 터미널에 표시
  - 화살표 키로 커서 이동
  - 한글 입력 테스트
- **다음 단계 준비**: 입력을 백엔드(프로세스)로 전송하고 출력을 받을 준비 완료

## Phase 5: I/O 연동

### 5.1 스트림 처리
- [ ] `TerminalBackend` 인터페이스 정의
  - `Stream<String>` 출력 스트림
  - `void write(String data)` 입력 메서드
- [ ] `Terminal`과 `TerminalBackend` 연결
  - 출력 스트림 → 파서 → 버퍼 업데이트
  - 키 입력 → backend로 전송
- [ ] UTF-8 인코딩/디코딩 처리

### 5.2 테스트용 백엔드
- [ ] `LoopbackBackend` 구현 (에코 테스트용)
- [ ] `MockBackend` 구현 (단위 테스트용)

### ✅ Phase 5 완료 후 기대 결과 (MVP 완성!)
- **양방향 통신**: 입력 → 백엔드 → 출력 → 화면 표시의 전체 루프 완성
- **에코 테스트**: 타이핑한 내용이 에코되어 돌아옴 (LoopbackBackend)
- **비동기 처리**: Stream을 통한 실시간 데이터 처리
- **Example 앱에서 확인**:
  - 타이핑하면 에코되어 표시
  - `cat` 같은 명령어 시뮬레이션 가능
  - 실시간으로 데이터 스트림 처리
- **MVP 완성**: 기본적인 터미널 에뮬레이터로 동작!
- **다음 단계 준비**: 실용적인 기능 추가 (선택, 복사, 스크롤)

## Phase 6: 사용자 기능

### 6.1 텍스트 선택
- [ ] 마우스 드래그로 선택
- [ ] 더블클릭: 단어 선택
- [ ] 트리플클릭: 라인 선택
- [ ] 선택 영역 하이라이트

### 6.2 클립보드
- [ ] 선택한 텍스트 복사
- [ ] 붙여넣기 (Ctrl+V, 우클릭)
- [ ] 플랫폼별 클립보드 연동

### 6.3 스크롤
- [ ] 스크롤백 버퍼 구현 (히스토리)
- [ ] 마우스 휠 스크롤
- [ ] 스크롤바 (옵션)
- [ ] 출력 시 자동 스크롤 (맨 아래로)

### ✅ Phase 6 완료 후 기대 결과
- **텍스트 선택**: 마우스로 드래그해서 텍스트 선택 가능
- **복사/붙여넣기**: Ctrl+C/Ctrl+V 또는 우클릭으로 복사/붙여넣기
- **스크롤**: 출력이 많을 때 마우스 휠로 이전 내용 확인
- **Example 앱에서 확인**:
  - 긴 출력 후 스크롤해서 이전 내용 보기
  - 텍스트 선택 및 복사
  - 다른 앱에 붙여넣기 테스트
- **다음 단계 준비**: 외관 커스터마이징 (테마 시스템)

## Phase 7: 테마 및 설정

### 7.1 테마 시스템
- [ ] `TerminalTheme` 클래스 정의
  - 색상 팔레트
  - 폰트 설정
  - 커서 스타일
  - 배경색
- [ ] 미리 정의된 테마
  - Default (밝음)
  - Dark
  - Solarized
  - Dracula 등

### 7.2 커스터마이징
- [ ] 폰트 크기 조정
- [ ] 커서 모양 (블록, 언더라인, 바)
- [ ] 커서 깜빡임 속도
- [ ] 투명도 설정 (옵션)

### ✅ Phase 7 완료 후 기대 결과
- **다양한 테마**: Dark, Solarized, Dracula 등 여러 테마 적용 가능
- **커스터마이징**: 폰트 크기, 커서 스타일 등 설정 변경
- **Example 앱에서 확인**:
  - 드롭다운으로 테마 전환
  - 슬라이더로 폰트 크기 조정
  - 커서 모양 변경 (블록/언더라인/바)
- **실용적인 버전 완성**: 일반 사용자가 사용할 수 있는 수준!
- **다음 단계 준비**: 고급 기능 추가 (링크, 검색)

## Phase 8: 고급 기능

### 8.1 링크 감지
- [ ] URL 패턴 인식
- [ ] 클릭 가능한 링크 (hover 효과)
- [ ] 링크 클릭 시 콜백

### 8.2 검색
- [ ] 텍스트 검색 기능
- [ ] 정규식 지원
- [ ] 이전/다음 검색
- [ ] 검색 결과 하이라이트

### 8.3 기타
- [ ] 벨 알림 (시각적 플래시)
- [ ] 라인 넘버 표시 (옵션)
- [ ] 성능 모니터링 (FPS, 렌더링 시간)

### ✅ Phase 8 완료 후 기대 결과
- **링크 클릭**: 터미널에 출력된 URL을 클릭하면 브라우저에서 열림
- **텍스트 검색**: Ctrl+F로 터미널 내용 검색 가능
- **Example 앱에서 확인**:
  - URL이 포함된 출력에서 링크 클릭
  - 검색 창으로 텍스트 찾기
  - 검색 결과 하이라이트
- **다음 단계 준비**: 실제 shell 프로세스 연동 (PTY)

## Phase 9: PTY 연동 (선택사항)

### 9.1 Dart FFI 기반 PTY
- [ ] Linux/macOS PTY 구현
  - posix_openpt, grantpt, unlockpt
  - fork + exec
- [ ] Windows ConPTY 구현
  - CreatePseudoConsole API
- [ ] `PtyBackend` 클래스 구현
  - 프로세스 생성 및 관리
  - 데이터 읽기/쓰기

### 9.2 셸 실행
- [ ] 기본 셸 감지 (bash, zsh, cmd, powershell)
- [ ] 환경변수 전달
- [ ] 작업 디렉토리 설정
- [ ] 프로세스 종료 처리

### ✅ Phase 9 완료 후 기대 결과
- **실제 shell 실행**: bash, zsh, cmd, powershell 등 실제 shell 프로세스 실행
- **완전한 터미널**: ls, cd, vim 등 모든 명령어 실행 가능
- **Example 앱에서 확인**:
  - 앱 실행 시 shell이 자동으로 시작
  - `ls`, `cd`, `cat` 등 실제 명령어 실행
  - `vim`, `nano` 같은 인터랙티브 프로그램 실행
  - 프로세스 종료 감지 및 재시작
- **완전한 터미널 에뮬레이터**: 실제 터미널 앱으로 사용 가능!
- **다음 단계 준비**: 품질 보증 (테스트 및 문서화)

## Phase 10: 테스트 및 문서화

### 10.1 단위 테스트
- [ ] Buffer, Cell, Cursor 테스트
- [ ] Parser 테스트 (각 escape sequence)
- [ ] Terminal 로직 테스트

### 10.2 위젯 테스트
- [ ] TerminalView 렌더링 테스트
- [ ] 입력 처리 테스트
- [ ] 선택 및 복사 테스트

### 10.3 통합 테스트
- [ ] E2E 시나리오 테스트
- [ ] 실제 프로세스 연동 테스트

### 10.4 문서화
- [ ] API 문서 (dartdoc)
- [ ] 사용 예제 (example 앱)
- [ ] README 작성
- [ ] 아키텍처 문서

### ✅ Phase 10 완료 후 기대 결과
- **안정성 확보**: 모든 핵심 기능에 대한 테스트 커버리지 확보
- **문서 완비**: 사용법, API, 아키텍처 문서 완성
- **Example 앱에서 확인**:
  - 모든 테스트 통과 확인
  - 문서 생성 (flutter pub run dartdoc)
  - README 예제 코드 동작 확인
- **다음 단계 준비**: pub.dev 배포 준비

## Phase 11: 예제 및 배포

### 11.1 예제 앱
- [ ] 기본 터미널 앱
- [ ] 테마 전환 예제
- [ ] PTY 연동 예제 (가능한 경우)

### 11.2 패키지 배포
- [ ] pub.dev 배포 준비
- [ ] 라이선스 확인
- [ ] CHANGELOG 작성
- [ ] 버전 관리

### ✅ Phase 11 완료 후 기대 결과
- **pub.dev 배포**: 누구나 `flutter pub add flutter_xterm`으로 설치 가능
- **풍부한 예제**: 다양한 사용 사례를 보여주는 example 앱
- **완성**:
  - pub.dev에 패키지 등록
  - 다른 개발자가 프로젝트에 추가 가능
  - 이슈 트래킹 및 커뮤니티 피드백 수집 시작
- **프로젝트 완료**: 최신 Flutter에서 동작하는 완전한 xterm 패키지!

---

## 구현 순서 권장사항

**최소 동작 가능 제품 (MVP)**: Phase 1 → 2 → 3 → 4 → 5.1, 5.2

이 단계까지 구현하면 기본적인 터미널 에뮬레이터가 동작합니다.

**실용적인 버전**: MVP + Phase 6 + Phase 7

**완전한 버전**: 위 + Phase 8 + Phase 9 + Phase 10 + Phase 11